# To manually create bthe helm release:

helm-{{ .Release.Name }}() {
  cat > values-oneweb-{{ .Release.Name }}.yaml <<EOF
#!/usr/bin/env helm upgrade -i oneweb-{{ .Release.Name }} --repo https://chart.onechart.dev onechart -n oneweb-{{ .Release.Name }} --create-namespace --values
image:
  repository: lalyos/12factor
  tag: readiness
ingress:
  host: {{ .Release.Name }}.{{ .Values.tld | default "k3z.eu" }}
vars:
  TITLE: {{ .Values.title | default .Release.Name }}
  COLOR2: {{ .Values.color | default "lightgreen" }}
  BODY: generated by OneChart wrapper
EOF
  chmod +x values-oneweb-{{ .Release.Name }}.yaml
  echo === helm upgrade -i {{ .Release.Name }} --repo https://chart.onechart.dev --values values-oneweb-{{ .Release.Name }}.yaml
}

r() {
  declare desc="magic function which creates the latest helm release without any gitops"
  
  last=$(helm ls --reverse -o json|jq .[0].name -r)
  echo === latest release: ${last} 1>&2
  eval "$(helm get notes ${last} | sed 1d)"
  echo === run: helm-${last} ... 1>&2
  helm-${last}
}

: <<=====USAGE
eval "$(helm get notes {{ .Release.Name }} | sed 1d)"
=====USAGE

